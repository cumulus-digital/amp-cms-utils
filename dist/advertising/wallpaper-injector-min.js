!function($,e,t){function n(){e._CMLS.logger(r+" v"+s,arguments)}function o(o){function i(){var e,n=document.createElement("fakeelement"),o={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkittransitionend",msTransition:"mstransitionend"};for(e in o)if(n.style[e]!==t)return o[e]}function r(){return v.dfpSlot=$(o.dfpSlotNode),v.injectionNode=$(o.injectionNode),v.stickNode=$(o.stickNode),v.contentNode=$(o.contentNode),v.footerNode=$(o.footerNode),v.obstructiveNode=$(o.obstructiveNode),v.window=$(e),v.document=$(e.document),a(),v}function a(){return n("Refreshing stick position."),v.stickAt=v.stickNode.length?v.stickNode.offset().top:0,v.stickAt}function s(){if(v.container&&v.container.length)return v.container;var e=$("#"+w+"Container");if(e.length)return v.container=e,v.container;n("Generating new wallpaper container."),r();var t=$("<div />",{id:w+"Container","class":w+"-container"});return v.injectionNode.prepend(t),v.container=t,d(),v.container}function d(){var e=s(),t={content:v.contentNode.css(["position","zIndex"]),footer:v.footerNode.css(["position","zIndex"])};"static"===t.content.position&&(n("Setting content area position to relative."),v.contentNode.css("position","relative")),("auto"===t.content.zIndex||t.content.zIndex<=e.css("zIndex"))&&(n("Raising content area above wallpaper container."),v.contentNode.css("zIndex",e.css("zIndex")+1)),"static"===t.footer.position&&(n("Setting footer area position to relative."),v.footerNode.css("position","relative")),v.contentNode.data("originalStyles",t.content),v.footerNode.data("originalStyles",t.footer),n("Content area has been raised.")}function c(){n("Displaying wallpaper.");var e=s();e.off(y).addClass(w+"-open"),v.obstructiveNode.hide(),f()}function l(){function e(){r=!0,v.obstructiveNode.show(),n("Clearing all event listeners."),v.window.off("."+w),n("Removing wallpaper container."),o.off("."+w).remove(),v.container=null,t.resolve()}var t=$.Deferred(),o=s(),i=o.hasClass(w+"-open"),r=!1;return n("RESET!"),o.off(y).removeData().removeProp("data").css("backgroundColor","rgba(0,0,0,0)").removeClass(w+"-open").removeClass(w+"-fixed"),n("Container is closing."),y&&i&&o.on(y,function(t){"opacity"===t.originalEvent.propertyName&&(n("Transition complete."),e())}),setTimeout(function(){r||e()},800),n("Returning our promise."),t.promise()}function p(){var e=s();return e.hasClass(w+"-fixed")}function g(e){var t=s();p()&&e===!1&&(n("Unfixing wallpaper position."),t.removeClass(w+"-fixed").css("top","0")),p()||e!==!0||(n("Fixing wallpaper position."),a(),t.addClass(w+"-fixed").css("top",v.stickAt))}function f(){function e(){var e=v.window.scrollTop(),t=v.injectionNode.length?v.injectionNode.offset().top:0;return t<e+v.stickAt?!0:!1}n("Initializing scroll tracking."),a(),g(e()?!0:!1),v.window.on("scroll."+w,b(function(){return e()?void g(!0):void g(!1)},50)),v.window.on("resize."+w,N(function(){a()},500)),n("Scroll tracking enabled.")}function u(){try{if($(o.contentNode).height()<200)return n("Content node is not ready, retrying."),void setTimeout(function(){u()},500);r(),n("Processing wallpaper slot.");var t=s(),i=v.dfpSlot.find("iframe"),a=i.contents().find("#google_image_div,body").first(),d=a.find("a:first"),p=d.find("img.img_ad:first,img:first").first(),g=p.prop("alt");if(n("Checking image."),!p.length)return n("No image found in ad slot! Resetting."),void l();n("Getting background color.",g);var f="rgba(255,255,255,0)",m=g.match(/(\#[A-Za-z0-9]+)/)||!1;m&&m.length>1&&(f=m[1]),n("Using background color.",f),l().then(function(){n("Building the new wallpaper.");var o=$("<a />",{href:d.prop("href"),target:d.prop("target")});e._CMLS.navThroughPlayer&&e._CMLS.navThroughPlayer.updateLink(o,!0);var i=$("<iframe />",{name:w+"Iframe",scrolling:"no",marginWidth:"0",marginHeight:"0",frameborder:"0"});n("Injecting iframe into container."),t=s(),t.css("backgroundColor",f).append(i);var r='<style>html,body{background:transparent;margin:0;padding:0;width:100%;height:100%;}body{background:url("'+p.prop("src")+'") no-repeat top center;}a{display:block;width:100%;height:100%;text-decoration:none;}</style>';i.load(function(){n("Injecting wallpaper into iframe."),i.contents().find("body").append(r,o)}).prop("src","about:blank"),p.length?(n("Initializing preloader."),$("<img />").bind("load",function(){c(),$(this).remove()}).prop("src",p.prop("src"))):c()})}catch(h){console.log("WTF PEOPLE",h)}}function m(e){var t=e.slot.getTargeting("pos");return t.indexOf("wallpaper-ad")>-1?(n("Caught render event for wallpaper-ad",e.slot.getSlotElementId()),e.isEmpty?(n("Slot was empty, resetting wallpaper container."),l()):(n("Slot contained an ad, processing wallpaper."),u()),!1):void 0}function h(){$(e).off("."+w)}var v={},w=o.nameSpace||"wallpaperInjector",b=e._CMLS.throttle,N=e._CMLS.debounce,y=i();this.reset=l,this.process=u,this.unbindAllListeners=h,n("Initializing."),e.googletag=e.googletag||{},e.googletag.cmd=e.googletag.cmd||[],e.googletag.cmd.push(function(){e.googletag.pubads().addEventListener("slotRenderEnded",function(e){N(m(e),1e3)})});var k='<style id="'+w+'Styles">.'+w+"-container {display: block !important;position: absolute;z-index: 0;top: 0;left: 0;height: 0 !important;width: 100% !important;overflow: hidden;text-align: center;transition: opacity 0.5s, height 0.6s, background-color 0.4s;opacity: 0;}."+w+"-container iframe {border: 0;height: 100%;width: 100%;}."+w+"-container ~ .grid-container {transition: box-shadow 0.6s}."+w+"-open {height: 100% !important;opacity: 1;}."+w+"-open ~ .grid-container {box-shadow: 0 0 20px rgba(0,0,0,0.3);}."+w+"-fixed {position: fixed;}"+o.dfpSlotNode+" {display: none !important;}</style>";e.document.getElementById(w+"Styles")||$("head").append(k),"complete"===e.document.readyState||"loaded"===e.document.readyState?u():$(function(){u()})}var i={dfpSlotNode:"#div-gpt-ad-1418849849333-16",injectionNode:".wrapper-content",stickNode:".wrapper-header",contentNode:".wrapper-content .grid-container:first",footerNode:".wrapper-footer",obstructiveNode:".takeover-left, .takeover-right, .skyscraper-left, .skyscraper-right"},r="WALLPAPER INJECTOR",a="wallpaperInjector",s="0.4";e._CMLS[a]||(i.nameSpace=a,e._CMLS[a]=new o(i))}(jQuery,window);
//# sourceMappingURL=./wallpaper-injector-min.js.map