!function($,e,o){function t(){if(e._CMLS&&e._CMLS.debug&&"object"==typeof console&&console.log){var o=new Date;o=o.toISOString()?o.toISOString():o.toUTCString(),console.log("[WALLPAPER INJECTOR "+d+"]",o,[].slice.call(arguments))}}function n(){l.cache.node=$(l.settings.injectionNode),l.cache.stickNode=$(l.settings.stickNode),l.cache.stickAt=l.cache.stickNode.offset().top,l.cache.contentNode=$(l.settings.contentNode),l.cache.footerNode=$(l.settings.footerNode),l.cache.window=$(e),l.cache.document=$(e.document),l.cache.obstructiveNode=$(l.settings.obstructiveNode)}function a(e,o){var t=null;return function(){var n=this,a=arguments;clearTimeout(t),t=setTimeout(function(){e.apply(n,a)},o)}}function r(e,o,t){o=o||(o=250);var n,a;return function(){var r=t||this,i=+new Date,c=arguments;n&&n+o>i?(clearTimeout(a),a=setTimeout(function(){n=i,e.apply(r,c)},o)):(n=i,e.apply(r,c))}}function i(){e[s]=new h}function c(o){if(g=!0,n(),l.cache.contentNode.width()<100)return void setTimeout(function(){c(o)},480);if(t("Content node ready."),!o&&e[s]&&(o=e[s].slice(-1)[0]),!e[s]||!e[s].length)return t("Received empty request, resetting wallpaper."),void k.reset();i();var a=$.extend({},u,o);t("Processing request:",a);var r=k.getCurrentRequestData();return t("Testing current wallpaper against request.",r,a),r&&r.backgroundImage===a.backgroundImage&&r.backgroundRepeat===a.backgroundRepeat&&r.backgroundSize===a.backgroundSize&&r.backgroundPosition===a.backgroundPosition&&r.backgroundColor===a.backgroundColor&&r.newWindow===a.newWindow&&r.trackPosition===a.trackPosition?void t("Requested wallpaper is already set."):(t("Generating wallpaper."),void k.reset(function(){k.generate(a)},a.backgroundColor))}var s="cmlsWallpaperInjector",d="0.12",g=!1;if(e.tgmp&&e===e.top)return void t("Using TuneGenie player and injected in top window, ejecting.");if(!e._CMLS||!e._CMLS[s+"Injected"]){var l={settings:{injectionNode:".wrapper-content",stickNode:".wrapper-header",contentNode:".wrapper-content .grid-container:first",footerNode:".wrapper-footer",obstructiveNode:".takeover-left, .takeover-right, .skyscraper-left, .skyscraper-right"},cache:{}},u={backgroundImage:null,backgroundRepeat:"no-repeat",backgroundSize:"auto",backgroundPosition:"center top",backgroundColor:null,clickThrough:null,newWindow:!0,trackPosition:!0};e[s]=e[s]||[];var p='<style id="'+s+'Styles">.'+s+"-base {background-position: 50% -4000px;position: absolute;z-index: 0;top: 0;right: 0;bottom: 0;left: 0;}."+s+"-out {background-position: 50% -4000px;-webkit-transition: background-position 0.8s, background-color 0.7s;-moz-transition: background-position 0.8s, background-color 0.7s;-o-transition: background-position 0.8s, background-color 0.7s;-ms-transition: background-position 0.8s, background-color 0.7s;transition: background-position 0.8s, background-color 0.7s;}."+s+"-in {background-position: 50% 0%;-webkit-transition: background-position 0.4s, background-color 0.7s;-moz-transition: background-position 0.4s, background-color 0.7s;-o-transition: background-position 0.4s, background-color 0.7s;-ms-transition: background-position 0.4s, background-color 0.7s;transition: background-position 0.4s, background-color 0.7s;}"+l.settings.contentNode+" {-webkit-transition: box-shadow 1s;-moz-transition: box-shadow 1s;-o-transition: box-shadow 1s;-ms-transition: box-shadow 1s;transition: box-shadow 1s;}."+s+"-in ~ .grid-container {box-shadow: 0 0 20px rgba(0,0,0,0.3);}."+s+"-fixed {position: fixed;top: 0;}</style>";e.document.getElementById(s+"Styles")||$("head").append(p),n();var k={bgNode:null,getBackgroundNode:function(){if(k.bgNode&&k.bgNode.length)return k.bgNode;var e=l.cache.node.children("#"+s+"Node");if(e.length)t("Wallpaper container exists but is not cached."),k.bgNode=e;else{t("Injecting wallpaper container.");var o=$('<div id="'+s+'Node" />');l.cache.node.prepend(o),k.bgNode=$("#"+s+"Node"),k.bgNode.addClass(s+"-base").css("zIndex"),k.raiseContentArea()}return k.bgNode},getCurrentRequestData:function(){var e=k.getBackgroundNode(),o=null;return t("Retrieving current wallpaper settings.",$.hasData(e[0])),$.hasData(e[0])&&e.data("requestOptions")&&(o=e.data("requestOptions")),t("Current wallpaper settings:",o),o},clearListeners:function(){t("Clearing all event listeners."),l.cache.window.off("."+s),l.cache.document.off("."+s)},reset:function(o,a){function r(){t("RESET: Clearing wallpaper."),i.removeClass(s+"-out").attr("style","").css("backgroundColor",a),k.bgNode=null,o?(t("RESET: Firing callback."),o()):t("RESET: No callback specified, wallpaper is reset.")}t("Resetting."),n(),k.clearListeners(),l.cache.obstructiveNode.show();var i=k.getBackgroundNode();if(i.removeData().removeAttr("data").addClass(s+"-out").removeClass(s+"-in").css("backgroundPosition",""),a||(a="transparent"),i.css("backgroundColor",a),$("html").hasClass("csstransitions")){t("RESET: Waiting for transition.");var c=300;"none"!==i.css("backgroundImage")&&(t("RESET: Already has a wallpaper, increasing transition timer.",i.css("backgroundImage")),c=600),setTimeout(function(){e._CMLS.skip||r()},c)}else r()},setBackgroundFixed:function(e){var o=k.getBackgroundNode();o.hasClass(s+"-fixed")&&e!==!0||(o.addClass(s+"-fixed"),o.css("top",l.cache.stickAt))},clearBackgroundFixed:function(){var e=k.getBackgroundNode();e.hasClass(s+"-fixed")&&e.removeClass(s+"-fixed").css("top","")},refreshStickPosition:function(){return t("Refreshing stick position."),l.cache.stickAt=l.cache.stickNode.offset().top,l.cache.stickAt},passedStickPosition:function(){var e=l.cache.window.scrollTop(),o=l.cache.node.offset().top;return o<e+l.cache.stickAt?!0:!1},checkScrollPosition:function(e){return k.passedStickPosition()?void k.setBackgroundFixed(e):void k.clearBackgroundFixed()},startTrackingScroll:function(){t("Initializing scroll tracking.");var e=k.getBackgroundNode();k.refreshStickPosition(),k.checkScrollPosition(!0),e.data("trackingScroll",1),l.cache.window.on("scroll."+s,r(function(){k.checkScrollPosition()},60)),l.cache.window.on("resize."+s,a(function(){k.refreshStickPosition()},480))},raiseContentArea:function(){t("Raising content area above wallpaper container.");var e=k.getBackgroundNode(),o=l.cache.contentNode.css(["position","zIndex"]),n=l.cache.footerNode.css(["position","zIndex"]);"static"===o.position&&(t("Setting content area position to relative."),l.cache.contentNode.css("position","relative")),("auto"===o.zIndex||o.zIndex<=e.css("zIndex"))&&(t("Setting content area z-index."),l.cache.contentNode.css("zIndex",e.css("zIndex")+1)),"static"===n.position&&(t("Setting footer position to relative."),l.cache.footerNode.css("position","relative")),l.cache.contentNode.data("originalStyles",o),l.cache.footerNode.data("originalStyles",n),t("Content area raised.")},lowerContentArea:function(){$.hasData(l.cache.contentNode[0])&&l.cache.contentNode.data("originalStyles")&&l.cache.contentNode.css(l.cache.contentNode.data("originalStyles")),$.hasData(l.cache.footerNode[0])&&l.cache.footerNode.data("originalStyles")&&l.cache.footerNode.css(l.cache.footerNode.data("originalStyles"))},injectClickThrough:function(e,o){var t=k.getBackgroundNode(),n=$("<a/>");t.children("a").remove(),n.css({display:"block",height:"100%",width:"100%"}).attr("href",e),o&&n.attr("target","_blank"),t.append(n),l.cache.obstructiveNode.hide()},generate:function(e){function o(){t("Displaying new wallpaper.",r),a.css(r).addClass(s+"-in").removeClass(s+"-out"),g=!1}t("Generating wallpaper injection.");var n=$.extend({},u,e),a=k.getBackgroundNode(),r={};n.backgroundImage&&(r.backgroundImage='url("'+n.backgroundImage+'")',r.backgroundRepeat=n.backgroundRepeat,r.backgroundSize=n.backgroundSize),n.backgroundColor&&(r.backgroundColor=n.backgroundColor),n.clickThrough&&k.injectClickThrough(n.clickThrough,n.newWindow),a.data("requestOptions",n),n.backgroundImage?(t("Preloading new wallpaper image."),a.addClass(s+"-out"),$("<img/>").load(function(){$(this).remove(),o()}).attr("src",n.backgroundImage)):o(),n.trackPosition&&k.startTrackingScroll()}},h=function(){};h.prototype=[],h.prototype.verifyLibrary=function(){return d},h.prototype.originalPush=h.prototype.push,h.prototype.push=function(){t("Push has been called on Injector Array.");for(var e=0;e<arguments.length;e++)this.originalPush(arguments[e]);c()},$(function(){e[s]&&e[s].length&&(t("Found existing injection request, processing...",e[s]),c()),e.googletag=e.googletag||{},e.googletag.cmd=e.googletag.cmd||[],googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",function(o){var n=o.slot.getTargeting("pos");("wallpaper-ad"===n.toLowerCase()||n.length&&n.indexOf("wallpaper-ad")>-1)&&(t('Caught googletag render on position "wallpaper-ad"!',JSON.stringify(e[s])),o.isEmpty?(t("Googletag render contained no request, considering this a reset request."),r(c(),2e3)):t("Googletag render contained a request, letting request fall to WallpaperInjectorArray handler."))})}),i(),e._CMLS[s+"Injected"]=1,t("Initialized.")})}}(jQuery,window.self);
//# sourceMappingURL=./wallpaper-injector-min.js.map