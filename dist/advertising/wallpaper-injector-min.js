!function($,t,e){function i(){t._CMLS.logger(a+" v"+s,arguments)}function o(){var t,i=document.createElement("fakeelement"),o={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkittransitionend",msTransition:"mstransitionend"};for(t in o)if(i.style[t]!==e)return o[t]}var n={dfpSlotNode:"#div-gpt-ad-1418849849333-16",injectionNode:".wrapper-content",stickNode:".wrapper-header",contentNode:".wrapper-content .grid-container:first",footerNode:".wrapper-footer",obstructiveNode:".takeover-left, .takeover-right, .skyscraper-left, .skyscraper-right"},a="WALLPAPER INJECTOR",r="cmlsWallpaperInjector",s="0.3";t._CMLS[r]||(n.transitionEvent=o(),t._CMLS[r]={version:s,cache:{},refreshCache:function c(){this.cache.dfpSlot=$(n.dfpSlotNode),this.cache.injectionNode=$(n.injectionNode),this.cache.stickNode=$(n.stickNod),this.cache.stickAt=this.cache.stickNode.length?this.cache.stickNode.offset().top:0,this.cache.contentNode=$(n.contentNode),this.cache.footerNode=$(n.footerNode),this.cache.obstructiveNode=$(n.obstructiveNode),this.cache.window=$(t),this.cache.document=$(t.document)},refreshStickAtPosition:function h(){return i("Refreshing stick position."),this.cache.stickAt=this.cache.stickNode.length?this.cache.stickNode.offset().top:0,this.cache.stickAt},getContainer:function d(){if(this.cache.container&&this.cache.container.length)return this.cache.container;var t=$("#"+r+"Container");if(t.length)return this.cache.container=t,this.cache.container;i("Generating new wallpaper container.");var e=$('<div id="'+r+'Container" class="'+r+'-container" />');return this.cache.injectionNode.prepend(e),this.cache.container=e,this.raiseContentArea(),this.cache.container},raiseContentArea:function p(){var t=this.getContainer(),e={content:this.cache.contentNode.css(["position","zIndex"]),footer:this.cache.footerNode.css(["position","zIndex"])};"static"===e.content.position.toLowerCase()&&(i("Setting content area position to relative."),this.cache.contentNode.css("position","relative")),("auto"===e.content.zIndex.toLowerCase()||e.content.zIndex<=t.css("zIndex"))&&(i("Raising content area above wallpaper container."),this.cache.contentNode.css("zIndex",t.css("zIndex")+1)),"static"===e.footer.position.toLowerCase()&&(i("Setting footer area position to relative."),this.cache.footerNode.css("position","relative")),this.cache.contentNode.data("originalStyles",e.content),this.cache.footerNode.data("originalStyles",e.footer),i("Content area has been raised.")},show:function l(){i("Displaying wallpaper.");var t=this.getContainer();t.off(n.transitionEvent).addClass(r+"-open"),this.cache.obstructiveNode.hide(),this.startTrackingScroll()},reset:function g(t){function e(){i("Removing wallpaper contents."),o.empty().css("top","0"),a.cache.obstructiveNode.show(),i("Clearing event listeners."),a.cache.window.off("."+r),a.cache.document.off("."+r),"function"==typeof t&&(i("Firing reset callback."),t())}var o=this.getContainer();i("Removing wallpaper.");var a=this,s=o.hasClass(r+"-open");o.off(n.transitionEvent).removeData().removeProp("data").css("backgroundColor","rgba(0,0,0,0)").removeClass(r+"-open").removeClass(r+"-fixed"),n.transitionEvent&&s?(i("Setting transition watch."),o.on(n.transitionEvent,function(t){i("Transition complete.",t.originalEvent.propertyName),"opacity"===t.originalEvent.propertyName&&(t.stopImmediatePropagation(),e())})):e()},setFixed:function f(t){var e=this.getContainer();e.hasClass(r+"-fixed")&&t!==!0||(i("Setting wallpaper position to fixed."),e.addClass(r+"-fixed").css("top",this.cache.stickAt))},unsetFixed:function u(){var t=this.getContainer();t.hasClass(r+"-fixed")&&(i("Unfixing wallpaper position."),t.removeClass(r+"-fixed").css("top","0"))},hasPassedStickPosition:function v(){var t=this.cache.window.scrollTop(),e=this.cache.injectionNode.length?this.cache.injectionNode.offset().top:0;return e<t+this.cache.stickAt?!0:!1},startTrackingScroll:function m(){i("Initializing scroll tracking.");var e=this;this.refreshStickAtPosition(),this.hasPassedStickPosition()?this.setFixed(!0):this.unsetFixed(),this.cache.window.on("scroll."+r,t._CMLS.throttle(function(){return e.hasPassedStickPosition()?void e.setFixed():void e.unsetFixed()},60)),this.cache.window.on("resize."+r,t._CMLS.debounce(function(){e.refreshStickAtPosition()},500)),i("Scroll tracking enabled.")},process:function w(){i("Processing wallpaper request."),this.refreshCache();var t=this.getContainer(),e=this;i("Retrieving data from ad slot.");var o=this.cache.dfpSlot.find("iframe"),n=o.contents().find("#google_image_div,body").first(),a=n.find("a:first"),s=a.find("img.img_ad:first,img").first(),c=s.prop("alt");if(i("Checking image."),!s.length)return i("No image found in ad slot!"),void this.reset();i("Checking background color.");var h="rgba(255,255,255,0)";if(c&&c.length<1){var d=h.match(/(\#[A-Za-z0-9]+)/);d&&d.length>1&&(i("Using background color.",h[1]),h=d[1])}this.reset(function p(){i("Building new wallpaper.");var n=$("<iframe />").prop("name",r+"Iframe").prop("scrolling","no").prop("marginwidth","0").prop("marginheight","0").prop("frameborder","0").prop("src","about:blank").prop("width",o.prop("width")).prop("height",o.prop("height")).css({border:0,verticalAlign:"bottom"});i("Injecting wallpaper into container."),t.css("backgroundColor",h).append(n),n.contents().find("head").append("<style>html,body { margin: 0; padding: 0; }</style>").end().find("body").append('<a href="'+a.prop("href")+'" target="'+a.prop("target")+'"><img src="'+s.prop("src")+'"></a>'),s.length?(i("Initializing load watch for ad image."),$("<img/>").bind("load",function(){e.show(),$(this).remove()}).prop("src",s.prop("src"))):e.show()})},init:function k(){i("Initializing"),this.refreshCache();var e=this;t.googletag=t.googletag||{},t.googletag.cmd=t.googletag.cmd||[],t.googletag.cmd.push(function(){t.googletag.pubads().addEventListener("slotRenderEnded",function(t){var o=t.slot.getTargeting("pos");return o.indexOf("wallpaper-ad")>-1?(i("Caught render event for wallpaper-ad",t.slot.getSlotElementId()),t.isEmpty?(i("Slot was empty, resetting wallpaper container."),e.reset()):(i("Slot contained an ad, processing wallpaper.",e),e.process()),!1):void 0})});var o='<style id="'+r+'Styles">.'+r+"-container {display: block !important;position: absolute;z-index: 0;top: 0;left: 0;height: 0 !important;width: 100% !important;overflow: hidden;text-align: center;transition: opacity 0.4s, height 0.5s, background-color 0.3s;opacity: 0;}."+r+"-container iframe {position: absolute;left: 50%;transform: translate(-50%, 0%);}."+r+"-open {height: 100% !important;opacity: 1;}."+r+"-open ~ .grid-container {box-shadow: 0 0 20px rgba(0,0,0,0.3);transition: box-shadow 0.5s}."+r+"-fixed {position: fixed;}"+n.dfpSlotNode+" {display: none !important;}</style>";t.document.getElementById(r+"Styles")||$("head").append(o)}},$(function(){t._CMLS[r].init()}))}(jQuery,window);
//# sourceMappingURL=./wallpaper-injector-min.js.map