!function(e,t){function log(){e.top._CMLS&&e.top._CMLS.hasOwnProperty("logger")&&e.top._CMLS.logger(i+" v"+o,arguments)}function initTest(){function testEventListener(t){r&&e.removeEventListener("cms-sgroup",testEventListener),t.detail.indexOf("Format")>-1&&(log('cms-sgroup "Format" event fired!'),initTest())}if(!r)return log("Testing initial state."),e._CMLS.cGroups?(e._CMLS.cGroups.forEach((function(t){if(!r)return/Format\s+.*(Talk|Sports)/i.test(t)?(log("Station is Talk or Sports format, initializing timer."),e._CMLS[n]=new AutoRefresher,void(r=!0)):void 0})),r?void 0:(log("Station is not Talk or Sports, no timer set."),!1)):(log("cGroups not available, will wait for cms-sgroup event."),void e.addEventListener("cms-sgroup",testEventListener,!1))}var i="AUTO REFRESH ADS",n="autoRefreshAds",o="0.5.4";if(e.DISABLE_AUTO_REFRESH_ADS)return log("Auto Refresh Ads is disabled"),!1;e._CMLS.autoRefreshAdsTimer=e._CMLS.autoRefreshAdsTimer||2;var AutoRefresher=function(t){function getWindow(){if(n.type===e._CMLS.const.PLAYER_TUNEGENIE){var t=e.top.document.querySelector('iframe#page_frame,iframe[name="pwm_pageFrame"]');if(t&&t.contentWindow)return log("Window context is TuneGenie frame"),t.contentWindow}return log("Window context is window"),e}function checkConditions(){return!e.top._CMLS.autoReload||!e.top._CMLS.autoReload.active||(log("AutoReloadPage is active, autoRefreshAds will be disabled."),!1)}function checkTimer(){if(!checkConditions())return log("Conditions have gone bad, killing timer."),void i.stop();var e=new Date;log("Checking timer",[e.toLocaleString(),r.toLocaleString()]),e.getTime()>=r.getTime()?fire():o=setTimeout(checkTimer,1e4)}function checkTuneGeniePlayerState(e){return!0===e?(log("TuneGenie Player is streaming."),i.start(),!0):(log("TuneGenie Player has stopped."),i.stop(),!1)}function fire(){if(!checkConditions())return log("Conditions have gone bad before firing, killing timer."),i.stop(),!1;var e=getWindow();log("Firing!",e._CMLS.adTag),e._CMLS.adTag.queue((function(){i.resetFireTime(),log("Refreshing viewable page ads.");try{var t=e._CMLS.adTag.pubads().getSlots(),n=[];t.forEach((function(t){var i=e.document.getElementById(t.getSlotElementId());i&&isElementVisible(i)&&n.push(t)})),log("Viewable ads:",n),e._CMLS.adTag.refresh(n)}catch(e){log("Failed to refresh ads!",e)}i.start()}))}function isElementVisible(t){"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]);var i=t.getBoundingClientRect();if(i.width=i.right-i.left,i.height=i.bottom-i.top,0===i.width||0===i.height)return!1;var n=i.top+i.height/2,o=i.right-i.width/2,r=i.bottom-i.height/2,a=i.left+i.width/2;return r>=0&&o>=0&&n<=(e.innerHeight||document.documentElement.clientHeight)&&a<=(e.innerWidth||document.documentElement.clientWidth)}var i=this,n=e._CMLS.whichPlayer(),o=null,r=t||null,a=!1;this.checkState=function(){return a},this.stop=function(){log("Stopping timer."),clearTimeout(o),o=null,r=null,a=!1},this.start=function(e){if(i.stop(),!checkConditions())return log("Conditions are bad, timer will not start."),i;e&&e instanceof Date?(log("Start called with a fire time.",e),r=e):i.resetFireTime(),log("Starting timer, will fire at "+r.toLocaleString()),checkTimer(),a=!0},this.destroy=function(){i.stop()},this.getFireTime=function(){return r},this.resetFireTime=function(){r=new Date((new Date).getTime()+6e4*e._CMLS.autoRefreshAdsTimer)},n.type===e._CMLS.const.PLAYER_TUNEGENIE&&(e.top.tgmp&&e.top.TGMP_EVENTS?(e.top.tgmp.addEventListener(e.top.TGMP_EVENTS.streamplaying,checkTuneGeniePlayerState),log("Now listening for TuneGenie Player events.")):log("TuneGenie player not available!")),r&&r instanceof Date&&(log("Instantiated with a time to fire, using it!"),i.start(r))},r=!1;log("Initializing."),initTest()}(window.self);
//# sourceMappingURL=auto-refresh-ads-min.js.map