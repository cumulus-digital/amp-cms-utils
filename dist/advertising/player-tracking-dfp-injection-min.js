!function(t,e){t._CMLS=t._CMLS||{},t._CMLS.embedPlayerWatch||(t._CMLS.embedPlayerWatch={v:"0.4",initialized:!1,trackIdCache:null,stateCache:!1,timer:null,interval:1e3,log:function a(){if(t._CMLS&&t._CMLS.debug&&"object"==typeof console&&console.log){var e=new Date;e=e.toISOString()?e.toISOString():e.toUTCString(),console.log("[PLAYER WATCH "+this.v+"]",e,[].slice.call(arguments))}},isChanged:function i(t){return t?t===this.trackIdCache?!1:!0:!1},getCurrentState:function n(){return localStorage?JSON.parse(localStorage.getItem("tdas.controller."+amp_player_config.station+"."+amp_player_config.stream_id+".events.current-state")):!1},checkCurrent:function s(){var e=this.getCurrentState();e&&e.data&&e.data.stream&&"LIVE_PLAYING"===e.data.stream.code.toUpperCase()?this.setPlayState(!0):this.setPlayState(!1),e&&e.data&&e.data.song&&e.data.song.id&&this.isChanged(e.data.song.id)&&(this.log("Song changed!",e.data.song.id),this.trackIdCache=e.data.song.id,this.setCriteria(e),this.sendEvent(t,"td-player.trackChange",e.data.song.id)),this.setTimer()},setPlayState:function r(e){e===!0&&this.stateCache===!1?(this.log("Player is currently streaming."),this.stateCache=!0,googletag.pubads().setTargeting("td-player-state","playing"),this.sendEvent(t,"td-player.playing")):e===!1&&this.stateCache===!0&&(this.log("Player is not currently streaming."),this.stateCache=!1,googletag.pubads().setTargeting("td-player-state","stopped"),this.sendEvent(t,"td-player.stopped"))},setCriteria:function o(e){t.googletag&&googletag.pubadsReady&&e&&e.data&&e.data.song&&(e=e.data.song,e.artist&&(this.log("Setting Artist",e.artist),googletag.pubads().setTargeting("td-player-artist",e.artist),this.sendEvent(t,"td-player.artist",e.artist)),e.album&&(this.log("Setting Album",e.album),googletag.pubads().setTargeting("td-player-album",e.album),this.sendEvent(t,"td-player.album",e.album)),e.title&&(this.log("Setting Track",e.title),googletag.pubads().setTargeting("td-player-track",e.title),this.sendEvent(t,"td-player.track",e.title)),e.id&&(this.log("Setting Song ID",e.id),googletag.pubads().setTargeting("td-player-id",e.id)))},sendEvent:function l(e,a,i){var n;t.document.createEvent?(n=t.document.createEvent("CustomEvent"),n.initCustomEvent(a,!0,!0,i)):n=new CustomEvent(a,{detail:i}),e.dispatchEvent(n)},setTimer:function g(){var t=this;clearTimeout(this.timer),this.timer=null,this.timer=setTimeout(function(){t.checkCurrent()},this.interval)},init:function d(){if(!t.amp_player_config||!t.amp_player_config.station||!t.amp_player_config.stream_id)return this.log("amp_player_config not available."),!1;this.checkCurrent();var e=this;return t.addEventListener("load",function(){e.log("Caught window load."),setTimeout(function(){e.log("Delayed window load track check firing."),e.checkCurrent()},1e3)},!1),this.setTimer(),this.initialized=!0,this.log("Initialized! Current track ID:",this.trackIdCache),this}},t._CMLS.embedPlayerWatch.init())}(window);
//# sourceMappingURL=./player-tracking-dfp-injection-min.js.map